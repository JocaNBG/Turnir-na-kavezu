<!DOCTYPE html>
<html lang="sr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Turnir na kavezu</title>
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icon-192.png">
  <meta name="theme-color" content="#000000">
  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("service-worker.js");
      });
    }
  </script>
  <style>
    body { font-family: sans-serif; padding: 10px; margin: 0; background-color: #f5f5f5; }
    h1, h2 { text-align: center; }
    .section { margin-bottom: 20px; background: white; padding: 10px; border-radius: 8px; }
    input, select, button, textarea { width: 100%; margin: 5px 0; padding: 8px; font-size: 16px; }
    table { width: 100%; border-collapse: collapse; font-size: 14px; }
    table, th, td { border: 1px solid #ccc; }
    th, td { padding: 5px; text-align: center; }
    .team-entry { display: flex; justify-content: space-between; align-items: center; }
    .team-entry button { width: auto; margin-left: 10px; padding: 5px 10px; }
  </style>
</head>
<body>
<h1>Turnir na kavezu</h1>

<div class="section">
  <h2>Unos timova</h2>
  <input type="text" id="teamName" placeholder="Ime tima">
  <textarea id="players" rows="2" placeholder="Igrači (npr: Marko, Luka, Ivan)"></textarea>
  <button onclick="addTeam()">Dodaj tim</button>
  <ul id="teamList"></ul>
</div>

<div class="section">
  <h2>Unos rezultata</h2>
  <select id="teamA"></select>
  <input type="number" id="scoreA" placeholder="Golovi tima A">
  <select id="teamB"></select>
  <input type="number" id="scoreB" placeholder="Golovi tima B">
  <button onclick="addResult()">Unesi rezultat</button>
</div>

<div class="section">
  <h2>Rang lista</h2>
  <button onclick="updateTable()">Osveži tabelu</button>
  <table id="rankingTable">
    <thead>
      <tr><th>Tim</th><th>Utakmice</th><th>P</th><th>N</th><th>I</th><th>Gol razlika</th><th>Poeni</th></tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<div class="section">
  <h2>Zakazivanje utakmica</h2>
  <button onclick="generateSchedule()">📅 Generiši raspored (automatski)</button>
  <h3>Ručno dodavanje meča</h3>
  <select id="manualTeamA"></select>
  <select id="manualTeamB"></select>
  <input type="date" id="manualDate">
  <input type="time" id="manualTime">
  <input type="text" id="manualLocation" placeholder="Lokacija">
  <button onclick="addManualMatch()">➕ Dodaj meč</button>
</div>

<div class="section">
  <h2>Lista utakmica</h2>
  <table id="matchesTable">
    <thead>
      <tr><th>#</th><th>Tim A</th><th>Tim B</th><th>Datum</th><th>Vreme</th><th>Lokacija</th><th>Rezultat</th></tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<div class="section">
  <h2>Deljenje & podešavanja</h2>
  <button onclick="copyData()">📋 Kopiraj podatke</button>
  <textarea id="importData" rows="4" placeholder="Nalepi podatke ovde..."></textarea>
  <button onclick="importData()">📥 Učitaj podatke</button>
  <button onclick="resetAll()">🗑 Obriši sve</button>
</div>

<script>
let teams = JSON.parse(localStorage.getItem("turnir_teams") || "[]");
let results = JSON.parse(localStorage.getItem("turnir_results") || "[]");
let matches = JSON.parse(localStorage.getItem("turnir_matches") || "[]");

function saveData() {
  localStorage.setItem("turnir_teams", JSON.stringify(teams));
  localStorage.setItem("turnir_results", JSON.stringify(results));
  localStorage.setItem("turnir_matches", JSON.stringify(matches));
}

function renderTeamList() {
  const ul = document.getElementById('teamList');
  ul.innerHTML = '';
  teams.forEach((team, i) => {
    const li = document.createElement('li');
    li.className = 'team-entry';
    li.innerHTML = `${i + 1}. ${team.name} (${team.players.join(', ')}) <button onclick="deleteTeam(${i})">🗑</button>`;
    ul.appendChild(li);
  });
}

function deleteTeam(index) {
  const teamName = teams[index].name;
  teams.splice(index, 1);
  results = results.filter(r => r.teamA !== teamName && r.teamB !== teamName);
  matches = matches.filter(m => m.teamA !== teamName && m.teamB !== teamName);
  renderTeamList(); updateDropdowns(); updateTable(); renderMatches(); saveData();
}

function updateDropdowns() {
  const selects = [document.getElementById('teamA'), document.getElementById('teamB'), document.getElementById('manualTeamA'), document.getElementById('manualTeamB')];
  selects.forEach(sel => {
    sel.innerHTML = '';
    teams.forEach(team => {
      const opt = document.createElement('option');
      opt.value = team.name;
      opt.textContent = team.name;
      sel.appendChild(opt);
    });
  });
}

function addTeam() {
  const name = document.getElementById('teamName').value.trim();
  const players = document.getElementById('players').value.split(/,|\\n/).map(p => p.trim()).filter(p => p);
  if (name && players.length === 3) {
    teams.push({ name, players });
    document.getElementById('teamName').value = '';
    document.getElementById('players').value = '';
    renderTeamList(); updateDropdowns(); saveData();
  } else {
    alert("Unesite ime tima i 3 igrača!");
  }
}

function addResult() {
  const a = document.getElementById('teamA').value;
  const b = document.getElementById('teamB').value;
  const sa = parseInt(document.getElementById('scoreA').value);
  const sb = parseInt(document.getElementById('scoreB').value);
  if (!a || !b || a === b || isNaN(sa) || isNaN(sb)) return alert("Unesite validne podatke.");
  results.push({ teamA: a, teamB: b, scoreA: sa, scoreB: sb });
  document.getElementById('scoreA').value = '';
  document.getElementById('scoreB').value = '';
  updateTable(); renderMatches(); saveData();
}

function updateTable() {
  let data = {};
  teams.forEach(t => data[t.name] = { team: t.name, played: 0, win: 0, draw: 0, loss: 0, gd: 0, pts: 0 });
  results.forEach(r => {
    const tA = data[r.teamA], tB = data[r.teamB];
    if (!tA || !tB) return;
    tA.played++; tB.played++;
    tA.gd += r.scoreA - r.scoreB;
    tB.gd += r.scoreB - r.scoreA;
    if (r.scoreA > r.scoreB) { tA.win++; tB.loss++; tA.pts += 3; }
    else if (r.scoreA < r.scoreB) { tB.win++; tA.loss++; tB.pts += 3; }
    else { tA.draw++; tB.draw++; tA.pts++; tB.pts++; }
  });
  const tbody = document.querySelector('#rankingTable tbody');
  tbody.innerHTML = '';
  Object.values(data).sort((a,b) => b.pts - a.pts || b.gd - a.gd).forEach(r => {
    tbody.innerHTML += `<tr><td>${r.team}</td><td>${r.played}</td><td>${r.win}</td><td>${r.draw}</td><td>${r.loss}</td><td>${r.gd}</td><td>${r.pts}</td></tr>`;
  });
}

function copyData() {
  const full = { teams, results, matches };
  navigator.clipboard.writeText(JSON.stringify(full, null, 2))
    .then(() => alert("Podaci kopirani!"));
}

function importData() {
  try {
    const d = JSON.parse(document.getElementById("importData").value);
    teams = d.teams || []; results = d.results || []; matches = d.matches || [];
    renderTeamList(); updateDropdowns(); updateTable(); renderMatches(); saveData();
    alert("Učitano!");
  } catch {
    alert("Nevalidni podaci.");
  }
}

function resetAll() {
  if (confirm("Obrisati sve podatke?")) {
    teams = []; results = []; matches = [];
    localStorage.clear();
    renderTeamList(); updateDropdowns(); updateTable(); renderMatches();
  }
}

function generateSchedule() {
  matches = [];
  for (let i = 0; i < teams.length; i++) {
    for (let j = i + 1; j < teams.length; j++) {
      matches.push({ teamA: teams[i].name, teamB: teams[j].name, date: "", time: "", location: "" });
    }
  }
  renderMatches(); saveData();
}

function addManualMatch() {
  const a = document.getElementById("manualTeamA").value;
  const b = document.getElementById("manualTeamB").value;
  const d = document.getElementById("manualDate").value;
  const t = document.getElementById("manualTime").value;
  const l = document.getElementById("manualLocation").value;
  if (!a || !b || a === b) return alert("Različiti timovi obavezni.");
  matches.push({ teamA: a, teamB: b, date: d, time: t, location: l });
  renderMatches(); saveData();
}

function renderMatches() {
  const tbody = document.querySelector("#matchesTable tbody");
  tbody.innerHTML = '';
  matches.forEach((m, i) => {
    const r = results.find(r => r.teamA === m.teamA && r.teamB === m.teamB);
    const rez = r ? `${r.scoreA}:${r.scoreB}` : `<button onclick="enterResult(${i})">Unesi</button>`;
    tbody.innerHTML += `<tr><td>${i+1}</td><td>${m.teamA}</td><td>${m.teamB}</td><td>${m.date||'-'}</td><td>${m.time||'-'}</td><td>${m.location||'-'}</td><td>${rez}</td></tr>`;
  });
}

function enterResult(i) {
  const a = prompt(`Golovi za ${matches[i].teamA}:`);
  const b = prompt(`Golovi za ${matches[i].teamB}:`);
  if (a !== null && b !== null) {
    results.push({ teamA: matches[i].teamA, teamB: matches[i].teamB, scoreA: parseInt(a), scoreB: parseInt(b) });
    renderMatches(); updateTable(); saveData();
  }
}

window.onload = () => {
  renderTeamList(); updateDropdowns(); updateTable(); renderMatches();
};
</script>
</body>
</html>
