
<!-- SAMO SCRIPT deo koji se menja (ostatak index.html ostaje isti) -->
<script>
let admin = false;
function checkAdmin() {
  const pass = document.getElementById("adminPassword").value;
  if (pass === "kavez45") {
    admin = true;
    document.getElementById("adminLogin").style.display = "none";
    document.querySelectorAll(".admin-only").forEach(e => e.style.display = "block");
    document.getElementById("adminBanner").style.display = "block";
    saveData();
  } else {
    alert("Pogrešna lozinka!");
  }
}
function logout() {
  admin = false;
  location.reload();
}

let teams = JSON.parse(localStorage.getItem("turnir_teams") || "[]");
let results = JSON.parse(localStorage.getItem("turnir_results") || "[]");
let matches = JSON.parse(localStorage.getItem("turnir_matches") || "[]");

function saveData() {
  localStorage.setItem("turnir_teams", JSON.stringify(teams));
  localStorage.setItem("turnir_results", JSON.stringify(results));
  localStorage.setItem("turnir_matches", JSON.stringify(matches));
}

function renderTeamList() {
  const ul = document.getElementById('teamList');
  ul.innerHTML = '';
  teams.forEach((team, i) => {
    const li = document.createElement('li');
    li.textContent = `${i + 1}. ${team.name} (${team.players.join(', ')})`;
    ul.appendChild(li);
  });
  updateDropdowns();
}

function updateDropdowns() {
  const dropdowns = [teamA, teamB, manualTeamA, manualTeamB];
  dropdowns.forEach(select => {
    select.innerHTML = '';
    teams.forEach(team => {
      const option = document.createElement('option');
      option.value = team.name;
      option.textContent = team.name;
      select.appendChild(option);
    });
  });
}

function addTeam() {
  const name = document.getElementById("teamName").value.trim();
  const players = document.getElementById("players").value.split(/,|\n/).map(p => p.trim()).filter(p => p);
  if (name && players.length === 3) {
    teams.push({ name, players });
    saveData();
    document.getElementById("teamName").value = '';
    document.getElementById("players").value = '';
    renderTeamList();
    updateTable();
  } else {
    alert("Unesite ime tima i 3 igrača!");
  }
}

function addResult() {
  const a = document.getElementById("teamA").value;
  const b = document.getElementById("teamB").value;
  const sa = parseInt(document.getElementById("scoreA").value);
  const sb = parseInt(document.getElementById("scoreB").value);
  if (!a || !b || a === b || isNaN(sa) || isNaN(sb)) return alert("Unesite validne podatke.");
  results.push({ teamA: a, teamB: b, scoreA: sa, scoreB: sb });
  document.getElementById("scoreA").value = '';
  document.getElementById("scoreB").value = '';
  saveData();
  updateTable();
  renderMatches();
}

function updateTable() {
  let table = {};
  teams.forEach(t => {
    table[t.name] = { team: t.name, played: 0, win: 0, draw: 0, loss: 0, gd: 0, pts: 0 };
  });
  results.forEach(r => {
    const tA = table[r.teamA], tB = table[r.teamB];
    tA.played++; tB.played++;
    tA.gd += r.scoreA - r.scoreB;
    tB.gd += r.scoreB - r.scoreA;
    if (r.scoreA > r.scoreB) { tA.win++; tB.loss++; tA.pts += 3; }
    else if (r.scoreA < r.scoreB) { tB.win++; tA.loss++; tB.pts += 3; }
    else { tA.draw++; tB.draw++; tA.pts++; tB.pts++; }
  });
  const tbody = document.querySelector('#rankingTable tbody');
  tbody.innerHTML = '';
  Object.values(table).sort((a,b) => b.pts - a.pts || b.gd - a.gd).forEach(row => {
    tbody.innerHTML += `<tr><td>${row.team}</td><td>${row.played}</td><td>${row.win}</td><td>${row.draw}</td><td>${row.loss}</td><td>${row.gd}</td><td>${row.pts}</td></tr>`;
  });
}

function copyData() {
  navigator.clipboard.writeText(JSON.stringify({teams, results, matches}, null, 2)).then(() => alert("Kopirano!"));
}

function importData() {
  try {
    const d = JSON.parse(document.getElementById("importData").value);
    teams = d.teams || []; results = d.results || []; matches = d.matches || [];
    saveData();
    renderTeamList(); updateTable(); renderMatches();
  } catch {
    alert("Nevalidni podaci");
  }
}

function resetAll() {
  if (confirm("Obrisati sve?")) {
    teams = []; results = []; matches = [];
    localStorage.clear();
    renderTeamList(); updateTable(); renderMatches();
  }
}

function generateSchedule() {
  matches = [];
  for (let i = 0; i < teams.length; i++) {
    for (let j = i + 1; j < teams.length; j++) {
      matches.push({ teamA: teams[i].name, teamB: teams[j].name, date: "", time: "", location: "" });
    }
  }
  saveData();
  renderMatches();
}

function addManualMatch() {
  const a = manualTeamA.value, b = manualTeamB.value;
  const d = manualDate.value, t = manualTime.value, l = manualLocation.value;
  if (a === b) return alert("Izaberi različite timove!");
  matches.push({ teamA: a, teamB: b, date: d, time: t, location: l });
  saveData();
  renderMatches();
}

function renderMatches() {
  const tbody = document.querySelector("#matchesTable tbody");
  tbody.innerHTML = '';
  matches.forEach((m, i) => {
    const rez = results.find(r => r.teamA === m.teamA && r.teamB === m.teamB);
    const rtext = rez ? `${rez.scoreA}:${rez.scoreB}` : (admin ? `<button onclick="enterResult(${i})">Unesi</button>` : '-');
    tbody.innerHTML += `<tr><td>${i+1}</td><td>${m.teamA}</td><td>${m.teamB}</td><td>${m.date || '-'}</td><td>${m.time || '-'}</td><td>${m.location || '-'}</td><td>${rtext}</td></tr>`;
  });
}

function enterResult(i) {
  const a = prompt(`Golovi za ${matches[i].teamA}:`);
  const b = prompt(`Golovi za ${matches[i].teamB}:`);
  if (a !== null && b !== null) {
    results.push({ teamA: matches[i].teamA, teamB: matches[i].teamB, scoreA: parseInt(a), scoreB: parseInt(b) });
    saveData();
    renderMatches(); updateTable();
  }
}

window.onload = () => {
  renderTeamList(); updateTable(); renderMatches();
};
</script>
